@{
    ViewData["Title"] = "Dashboard";
    ViewData["ActivePage"] = "Dashboard";

    var isAdmin = User.IsInRole("SuperAdmin");
    var isContributor = User.IsInRole("Contributor");
    var isManager = User.IsInRole("Manager");
    var canUpload = isAdmin || isContributor || isManager;

    var stats = ViewBag.Stats as LearnLink.Models.DashboardStatsViewModel;
    var recentResources = ViewBag.RecentResources as List<LearnLink.Models.ResourceViewModel> ?? new List<LearnLink.Models.ResourceViewModel>();
    var recentActivity = ViewBag.RecentActivity as List<LearnLink.Models.ActivityViewModel> ?? new List<LearnLink.Models.ActivityViewModel>();
}

<!-- Page Header -->
<div class="ll-page-header">
    <div class="d-flex justify-content-between align-items-start flex-wrap gap-3">
        <div>
            <h1 class="ll-page-title">Dashboard</h1>
            <div class="ll-breadcrumb">
                <a href="#">Home</a>
                <i class="bi bi-chevron-right small"></i>
                <span>Dashboard</span>
            </div>
        </div>
        @if (canUpload)
        {
        <div class="d-flex gap-2">
            <a href="@Url.Action("Upload", "Home")" class="ll-btn ll-btn-primary">
                <i class="bi bi-cloud-arrow-up"></i>
                Upload Resource
            </a>
        </div>
        }
    </div>
</div>

<!-- Stats Cards -->
<div class="row g-4 mb-4">
    <div class="col-6 col-sm-6 col-xl-3">
        <div class="ll-stat-card">
            <div class="ll-stat-icon primary">
                <i class="bi bi-folder2-open"></i>
            </div>
            <div class="ll-stat-content">
                <div class="ll-stat-value">@(stats?.TotalResources.ToString("N0") ?? "0")</div>
                <div class="ll-stat-label">Total Resources</div>
                <div class="ll-stat-change positive">
                    <i class="bi bi-arrow-up"></i>
                    12% from last month
                </div>
            </div>
        </div>
    </div>
    <div class="col-6 col-sm-6 col-xl-3">
        <div class="ll-stat-card">
            <div class="ll-stat-icon success">
                <i class="bi bi-download"></i>
            </div>
            <div class="ll-stat-content">
                <div class="ll-stat-value">@(stats?.TotalDownloads.ToString("N0") ?? "0")</div>
                <div class="ll-stat-label">Total Downloads</div>
                <div class="ll-stat-change positive">
                    <i class="bi bi-arrow-up"></i>
                    8% from last month
                </div>
            </div>
        </div>
    </div>
    <div class="col-6 col-sm-6 col-xl-3">
        <div class="ll-stat-card">
            <div class="ll-stat-icon warning">
                <i class="bi bi-people"></i>
            </div>
            <div class="ll-stat-content">
                <div class="ll-stat-value">@(stats?.ActiveUsers.ToString("N0") ?? "0")</div>
                <div class="ll-stat-label">Active Users</div>
                <div class="ll-stat-change positive">
                    <i class="bi bi-arrow-up"></i>
                    5% from last month
                </div>
            </div>
        </div>
    </div>
    <div class="col-6 col-sm-6 col-xl-3">
        <div class="ll-stat-card">
            <div class="ll-stat-icon info">
                <i class="bi bi-chat-square-text"></i>
            </div>
            <div class="ll-stat-content">
                <div class="ll-stat-value">@(stats?.ActiveDiscussions.ToString("N0") ?? "0")</div>
                <div class="ll-stat-label">Active Discussions</div>
                <div class="ll-stat-change negative">
                    <i class="bi bi-arrow-down"></i>
                    3% from last month
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row g-4">
    <!-- Recent Resources -->
    <div class="col-lg-8">
        <div class="ll-card">
            <div class="ll-card-header">
                <h5 class="ll-card-title">Recent Resources</h5>
                <a href="@Url.Action("Repository", "Home")" class="ll-btn ll-btn-outline ll-btn-sm">View All</a>
            </div>
            <div class="ll-card-body p-0">
                <!-- Desktop: Table view -->
                <div class="table-responsive">
                    <table class="ll-table">
                        <thead>
                            <tr>
                                <th>Resource</th>
                                <th>Subject</th>
                                <th>Contributor</th>
                                <th>Date</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var resource in recentResources)
                            {
                            <tr>
                                <td>
                                    <div class="d-flex align-items-center gap-3">
                                        <div style="width: 40px; height: 40px; background: @resource.IconBg; border-radius: 8px; display: flex; align-items: center; justify-content: center;">
                                            <i class="bi @resource.IconClass @resource.IconColor"></i>
                                        </div>
                                        <div>
                                            <div class="fw-medium">@resource.Title</div>
                                            <div class="small text-muted">@resource.FileFormat • @resource.FileSize</div>
                                        </div>
                                    </div>
                                </td>
                                <td><span class="ll-tag">@resource.Subject</span></td>
                                <td>@resource.Uploader</td>
                                <td>@resource.CreatedAt.ToString("MMM dd, yyyy")</td>
                                <td>@resource.Status</td>
                            </tr>
                            }
                        </tbody>
                    </table>
                </div>
                <!-- Mobile: Card list view -->
                <div class="ll-mobile-card-list">
                    @foreach (var resource in recentResources)
                    {
                    <div class="ll-mobile-card-item"
                         data-res-title="@resource.Title"
                         data-res-format="@resource.FileFormat"
                         data-res-size="@resource.FileSize"
                         data-res-subject="@resource.Subject"
                         data-res-uploader="@resource.Uploader"
                         data-res-date="@resource.CreatedAt.ToString("MMM dd, yyyy")"
                         data-res-status="@resource.Status"
                         data-res-grade="@resource.GradeLevel"
                         data-res-type="@resource.ResourceType">
                        <div class="ll-mobile-card-icon" style="background: @resource.IconBg;">
                            <i class="bi @resource.IconClass @resource.IconColor"></i>
                        </div>
                        <div class="ll-mobile-card-info">
                            <div class="ll-mobile-card-title">@resource.Title</div>
                            <div class="ll-mobile-card-sub">@resource.FileFormat • @resource.FileSize</div>
                        </div>
                        <div class="ll-mobile-card-chevron">
                            <i class="bi bi-chevron-right"></i>
                        </div>
                    </div>
                    }
                </div>
            </div>
        </div>
    </div>

    <!-- Right Sidebar -->
    <div class="col-lg-4">
        <!-- Recent Activity -->
        <div class="ll-card">
            <div class="ll-card-header">
                <h5 class="ll-card-title">Recent Activity</h5>
            </div>
            <div class="ll-card-body">
                @foreach (var activity in recentActivity)
                {
                <div class="ll-activity-item">
                    <div class="ll-activity-avatar" @(string.IsNullOrEmpty(activity.UserColor) ? "" : $"style=\"{activity.UserColor}\"")>@activity.UserInitials</div>
                    <div class="ll-activity-content">
                        <div class="ll-activity-text">
                            <strong>@activity.User</strong> @activity.Action "@activity.Target"
                        </div>
                        <div class="ll-activity-time">@activity.TimeAgo</div>
                    </div>
                </div>
                }
            </div>
        </div>
    </div>
</div>
