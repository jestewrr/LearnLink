@{
    ViewData["Title"] = "Best Practices & Recommendations";
    ViewData["ActivePage"] = "BestPractices";

    var recommendations = ViewBag.Recommendations as List<LearnLink.Models.ResourceViewModel> ?? new List<LearnLink.Models.ResourceViewModel>();
    var trending = ViewBag.Trending as List<LearnLink.Models.ResourceViewModel> ?? new List<LearnLink.Models.ResourceViewModel>();
    var continueReading = ViewBag.ContinueReading as List<LearnLink.Models.ReadingHistoryViewModel> ?? new List<LearnLink.Models.ReadingHistoryViewModel>();

    string GetGradient(string format) => format?.ToUpper() switch
    {
        "PDF" => "background: linear-gradient(135deg, #ef4444, #dc2626)",
        "DOCX" => "background: linear-gradient(135deg, #3b82f6, #2563eb)",
        "PPTX" => "background: linear-gradient(135deg, #f59e0b, #d97706)",
        "XLSX" => "background: linear-gradient(135deg, #10b981, #059669)",
        _ => "background: linear-gradient(135deg, #8b5cf6, #7c3aed)"
    };

    string GetIcon(string format) => format?.ToUpper() switch
    {
        "PDF" => "bi-file-earmark-pdf",
        "DOCX" => "bi-file-earmark-word",
        "PPTX" => "bi-file-earmark-ppt",
        "XLSX" => "bi-file-earmark-excel",
        _ => "bi-file-earmark"
    };

    string GetProgressColor(int pct) => pct >= 75 ? "primary" : pct >= 50 ? "success" : "warning";
}

<div class="ll-best-practices">
    <!-- Page Header -->
    <div class="ll-page-header">
        <div class="d-flex justify-content-between align-items-start flex-wrap gap-3">
            <div>
                <h1 class="ll-page-title">Best Practices & Recommendations</h1>
                <div class="ll-breadcrumb">
                    <a href="@Url.Action("Dashboard", "Home")">Home</a>
                    <i class="bi bi-chevron-right small"></i>
                    <span>Best Practices</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Personalized Recommendations Banner -->
    <div class="ll-card mb-4" style="background: linear-gradient(135deg, #fef3c7 0%, #fcd34d 100%); border: none;">
        <div class="ll-card-body py-4">
            <div class="row align-items-center">
                <div class="col-lg-8">
                    <h4 class="fw-bold mb-2"><i class="bi bi-stars me-2"></i>Personalized Recommendations</h4>
                    <p class="mb-0 text-dark opacity-75">Based on your reading history and interests, we've curated these resources just for you.
                       Keep exploring to get more accurate recommendations!</p>
                </div>
                <div class="col-lg-4 text-end d-none d-lg-block">
                    <i class="bi bi-magic" style="font-size: 4rem; opacity: 0.3;"></i>
                </div>
            </div>
        </div>
    </div>

    <div class="row g-4">
        <div class="col-lg-8">
            <!-- For You Section -->
            <div class="ll-card mb-4">
                <div class="ll-card-header">
                    <h5 class="ll-card-title"><i class="bi bi-person-heart me-2 text-danger"></i>Recommended for You</h5>
                    <span class="ll-badge ll-badge-info">Based on your history</span>
                </div>
                <div class="ll-card-body">
                    <div class="row g-3">
                        @{
                            int matchScore = 98;
                        }
                        @foreach (var resource in recommendations)
                        {
                        <div class="col-md-6">
                            <div class="d-flex gap-3 p-3 border rounded hover-shadow" style="transition: all 0.3s;">
                                <div style="width: 56px; height: 56px; @GetGradient(resource.FileFormat); border-radius: 12px; display: flex; align-items: center; justify-content: center; color: white; flex-shrink: 0;">
                                    <i class="bi @GetIcon(resource.FileFormat) fs-4"></i>
                                </div>
                                <div>
                                    <h6 class="fw-bold mb-1">@resource.Title</h6>
                                    <p class="small text-muted mb-2">@resource.Description</p>
                                    <div class="d-flex gap-2">
                                        <span class="ll-tag">@resource.Subject</span>
                                        <span class="ll-badge ll-badge-success">@(matchScore)% match</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                            matchScore -= new Random(resource.Title.GetHashCode()).Next(3, 8);
                        }
                    </div>
                </div>
            </div>
        </div>

        <div class="col-lg-4">
            <!-- Learning Progress -->
            <div class="ll-card mb-4">
                <div class="ll-card-header">
                    <h5 class="ll-card-title">Your Learning Progress</h5>
                </div>
                <div class="ll-card-body">
                    <div class="text-center mb-4">
                        <div style="width: 120px; height: 120px; margin: 0 auto; position: relative;">
                            <svg viewBox="0 0 36 36" style="transform: rotate(-90deg);">
                                <path d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" fill="none" stroke="#e2e8f0" stroke-width="3"/>
                                <path d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" fill="none" stroke="#2563eb" stroke-width="3" stroke-dasharray="72, 100"/>
                            </svg>
                            <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center;">
                                <div class="fs-4 fw-bold">72%</div>
                                <div class="small text-muted">Complete</div>
                            </div>
                        </div>
                    </div>
                    @{
                        var subjects = new[] {
                            ("Mathematics", 85, "primary"),
                            ("Science", 68, "success"),
                            ("English", 45, "#f59e0b"),
                            ("Filipino", 32, "#8b5cf6")
                        };
                    }
                    @foreach (var (subject, pct, color) in subjects)
                    {
                    <div class="mb-3">
                        <div class="d-flex justify-content-between small mb-1">
                            <span>@subject</span>
                            <span class="fw-medium">@(pct)%</span>
                        </div>
                        <div class="ll-progress">
                            <div class="ll-progress-bar @(color == "primary" || color == "success" ? color : "")" style="width: @(pct)%; @(color != "primary" && color != "success" ? $"background: {color};" : "")"></div>
                        </div>
                    </div>
                    }
                </div>
            </div>
        </div>

        <div class="col-12">
            <!-- Trending This Week -->
            <div class="ll-card mb-4">
                <div class="ll-card-header">
                    <h5 class="ll-card-title"><i class="bi bi-fire me-2 text-danger"></i>Trending This Week</h5>
                    <a href="@Url.Action("Repository", "Home")" class="ll-btn ll-btn-outline ll-btn-sm">View All</a>
                </div>
                <div class="ll-card-body p-0">
                    <div class="table-responsive">
                        <table class="ll-table">
                            <thead>
                                <tr>
                                    <th>Rank</th>
                                    <th>Resource</th>
                                    <th>Views</th>
                                    <th>Downloads</th>
                                    <th>Rating</th>
                                </tr>
                            </thead>
                            <tbody>
                                @{
                                    string[] medals = { "ü•á", "ü•à", "ü•â" };
                                    string[] badgeClasses = { "bg-warning text-dark", "bg-secondary", "bg-danger" };
                                }
                                @for (int i = 0; i < trending.Count; i++)
                                {
                                    var resource = trending[i];
                                <tr>
                                    <td>
                                        @if (i < 3)
                                        {
                                        <span class="badge @badgeClasses[i]">@medals[i] @(i + 1)</span>
                                        }
                                        else
                                        {
                                        <span class="badge bg-light text-dark">@(i + 1)</span>
                                        }
                                    </td>
                                    <td>
                                        <div class="d-flex align-items-center gap-2">
                                            <i class="bi @resource.IconClass @resource.IconColor"></i>
                                            <div>
                                                <div class="fw-medium">@resource.Title</div>
                                                <small class="text-muted">@resource.GradeLevel ‚Ä¢ @resource.Subject</small>
                                            </div>
                                        </div>
                                    </td>
                                    <td>@resource.ViewCount.ToString("N0")</td>
                                    <td>@resource.DownloadCount.ToString("N0")</td>
                                    <td>
                                        <div class="d-flex align-items-center gap-1">
                                            <i class="bi bi-star-fill text-warning"></i>
                                            <span>@resource.Rating.ToString("0.0")</span>
                                        </div>
                                    </td>
                                </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                    <!-- Mobile: Card list view -->
                    <div class="ll-mobile-card-list">
                        @for (int i = 0; i < trending.Count; i++)
                        {
                            var resource = trending[i];
                        <div class="ll-mobile-card-item"
                             data-res-title="@resource.Title"
                             data-res-subject="@resource.Subject"
                             data-res-grade="@resource.GradeLevel"
                             data-res-views="@resource.ViewCount.ToString("N0")"
                             data-res-downloads="@resource.DownloadCount.ToString("N0")"
                             data-res-rating="‚≠ê @resource.Rating.ToString("0.0")">
                            <div class="ll-mobile-card-icon" style="background: @resource.IconBg;">
                                <i class="bi @resource.IconClass @resource.IconColor"></i>
                            </div>
                            <div class="ll-mobile-card-info">
                                <div class="ll-mobile-card-title">@(i < 3 ? medals[i] : "") @resource.Title</div>
                                <div class="ll-mobile-card-sub">‚≠ê @resource.Rating.ToString("0.0") ‚Ä¢ @resource.ViewCount.ToString("N0") views</div>
                            </div>
                            <div class="ll-mobile-card-chevron">
                                <i class="bi bi-chevron-right"></i>
                            </div>
                        </div>
                        }
                    </div>
                </div>
            </div>
        </div>
    </div>
